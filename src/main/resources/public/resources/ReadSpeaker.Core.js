ReadSpeaker.Common=function(){var e={revision:-1!="3406-1".indexOf("%")?"DEV":"3406-1"},t={onAdapterReady:[],onInit:[],onCoreLoaded:[],onModsLoaded:[],onAfterModsLoaded:[],onAfterExtraModsLoaded:[],onConfigLoaded:[],onConfigSetup:[],onDOMReady:[],onReady:[],onSelectedText:[],onDeselectedText:[],onSettingsInitialized:[],onSettingsChanged:[],onSettingsLoaded:[],onSettingsClosed:[],onDownloadLoaded:[],onFocusIn:[],onFocusOut:[],onUIInitialized:[],onUIBeforePlay:[],onUIAfterPlay:[],onUIPause:[],onUISliderMove:[],onUIStop:[],onUIShowPlayer:[],onUIClosePlayer:[],onAPIPlay:[],onAPIPause:[],onAPIStop:[],onAPIVolumeUp:[],onAPIVolumeDown:[],onAPIMute:[],onAPIFastForward:[],onAPIRewind:[],onAPISetVolume:[],onAPISetProgress:[],onAPIGetProgress:[],onAPIInitAdapter:[],onAPIReleaseAdapter:[],onAPIReloadAdapter:[],onBeforeSyncInit:[],onAfterSyncInit:[],onBeforeSync:[],onAfterSync:[],onAfterSyncExit:[],onBeforeContentChange:[],onAfterContentChange:[],onBeforeGetAudioLink:[],onBeforeParamsSet:[],onAfterParamsSet:[],onAudioLoadError:[],onVolumeAdjusted:[],onChunkResume:[]},r={speed:function(e,t){var r=parseInt(t||rspkr.pub.Config.item("general.defaultSpeedValue")||100),n=parseInt(rspkr.pub.Config.item("general.defaultSlowSpeedValue")||r-25),s=parseInt(rspkr.pub.Config.item("general.defaultFastSpeedValue")||r+25);switch(e){case"slow":return n;case"medium":return r;case"fast":return s;default:return r}}},n={audioLink:null,params:{},postContent:"",postLink:null,saveLink:null,selectedHTML:"",selectedText:"",selectedRange:null,sync:"wordsent",syncLink:null,browser:{name:"",flashVersion:"",version:"",OS:"",html5AudioFormat:"",html5Support:!1,html5Priority:!1,syncContainer:""},setParams:function(e){function t(e,t){for(var r=0,n=e.length;n>r;r++)if(this[r]===t)return r;return-1}if(rspkr.log("[rspkr.c.data.setParams] "+e),"string"==typeof e){this.params={};var r="",n="",s="",a=e.split("?");rspkr.cfg.item("general.servercall",a[0]);for(var i=a[1].split(/[;&]/),o=0;o<i.length;o++)if(r=i[o].split("="),r&&2==r.length){n=decodeURIComponent(r[0]);var l=r[1];if(s=decodeURIComponent(r[1]),"url"!=n||s.length){if("lang"==n&&2==s.length){for(var d in rspkr.cfg.item("phrases"))if(rspkr.cfg.item("phrases").hasOwnProperty(d)&&s==d.substring(0,2)){l=d;break}}else if("readid"==n||"readclass"==n){for(var c=l.split(","),p=[],u=0;u<c.length;u++)-1==t(p,c[u])&&p.push(c[u]);l=p.join(",")}}else l=encodeURIComponent(document.location.href);this.params[n]=l}this.params.rsjs_ver=rspkr.getVersion(),this.params.synccontainer=this.browser.syncContainer,this.params.url||(this.params.url=document.location.href),this.params.readid=this.params.readid||"",(rspkr.c.data.selectedText||rspkr.c.data.selectedHTML)&&(delete this.params.readid,delete this.params.readclass),rspkr.Common.dispatchEvent("onAfterParamsSet")}},setDefaultValues:function(){rspkr.log("[rspkr.c.data.setDefaultValues] Called!"),rspkr.Common.data.selectedHTML="",rspkr.Common.data.saveLink=null},setPostContent:function(e){if("string"==typeof e)if("textsel"===e){var t=this.selectedHTML;rspkr.cfg.item("general.parseMathJax")===!0&&(t=this.parseMathJax(t)),this.postContent=p.encode(t)}else{var r=[],n="";rspkr.hl&&rspkr.hl.Restore.hasMarkup()&&rspkr.hl.sync.fullCleanUp();var s=[];rspkr.c.data.params.hasOwnProperty("readid")&&rspkr.c.data.params.readid.length&&(s=s.concat(("#"+rspkr.c.data.params.readid.split(",").join(",#")).split(","))),rspkr.c.data.params.hasOwnProperty("readclass")&&rspkr.c.data.params.readclass.length&&(s=s.concat(("."+rspkr.c.data.params.readclass.split(",").join(",.")).split(","))),r=$rs.get(s.join(",")),$rs.isArray(r)||(r=[r]);for(var a,i=0;a=r[i];i++){var o,l=a.id?' id="'+a.id+'"':"",d=a.className?' class="'+a.className+'"':"";o=a.nodeName&&"TABLE"==a.nodeName?"TABLE":"DIV",n+="<"+o+l+d+">"+a.innerHTML+"</"+o+">"}var c=document.createElement("div");c.innerHTML=n;var u=$rs.findIn(c,".rs_skip.rs_preserve");$rs.isArray(u)||(u=[u]);for(var a,h=0;a=u[h];h++)a.innerHTML="";n=c.innerHTML,rspkr.cfg.item("general.parseMathJax")===!0&&(n=this.parseMathJax(n)),this.postContent=p.encode(n)}},parseMathJax:function(e){var t,r,n,s,a,i=document.createElement("div"),o=window.MathJax;if(i.innerHTML=e,r=$rs.findIn(i,".MathJax")){t=$rs.findIn(r,".math"),$rs.isArray(t)&&0===t.length&&(t=r),t=$rs.isArray(t)?t:[t];for(var l=t.length-1;l>=0;l--)"object"==typeof t[l]&&(a=document.createElement("div"),mjaxObj=o.Hub.getJaxFor(t[l].id),a.innerHTML=mjaxObj.originalText,n=$rs.closest(t[l],"div.MathJax_Display"),$rs.hasClass(t[l],"math")?(t[l].parentNode.parentNode.replaceChild(a,t[l].parentNode),n&&n.tagName&&n.parentNode.replaceChild(a,n)):n?n.parentNode.replaceChild(a,n):t[l].parentNode.replaceChild(a,t[l]));s=i.getElementsByTagName("script");for(var d=s.length-1;d>=0;d--)s[d].type&&"math/mml"===s[d].type&&s[d].parentNode.removeChild(s[d]);return i.innerHTML}return e},setSelectedText:function(e){this.selectedText="";var t=void 0,r=void 0;window.getSelection?(r=window.getSelection(),r.isCollapsed||(r.getRangeAt?t=r.getRangeAt(0):(t=document.createRange(),t.setStart(r.anchorNode,r.anchorOffset),t.setEnd(r.focusNode,r.focusOffset)),t?(DOM=t.cloneContents(),object=document.createElement("div"),object.appendChild(DOM.cloneNode(!0)),this.selectedText=object.innerHTML):this.selectedText=r),this.selectedRange=t):document.selection?(r=document.selection,t=r.createRange(),this.selectedText=t&&t.htmlText&&t.text&&t.text.length>0?t.htmlText:t&&t.text?t.text:"",this.selectedRange=t.duplicate()):document.getSelection&&(this.selectedText=document.getSelection()),window.getSelection?this.selectedText.length>0&&window.getSelection().getRangeAt&&window.getSelection().getRangeAt(0)&&window.getSelection().getRangeAt(0).toString().length>0&&e?d("onSelectedText",window,[e]):(this.selectedText="",d("onDeselectedText",window,["empty"])):this.selectedText.length>0&&e?d("onSelectedText",window,[e]):d("onDeselectedText",window,["empty"]),rspkr.log("[rspkr.c.setSelectedText] Selected text length is "+this.selectedText.length)},createReadRange:function(e){var t=document.getElementById(e);if(t)if(document.selection&&(this.browser.version<9||document.documentMode<9)){var r=document.body.createTextRange();r.moveToElementText(t),this.selectedRange=r,this.selectedText=r.htmlText}else{var r=document.createRange();r.selectNodeContents(t),this.selectedRange=r,this.selectedText=r.toString()}},getParam:function(e){return this.params&&this.params[e]&&void 0!==this.params[e]?this.params[e]:null},getParams:function(){return this.params},getPostContent:function(){return this.postContent},getRestoreContent:function(){return this.restoreContent},getSelectedText:function(){return this.selectedText},getAudioLink:function(e,t){rspkr.devt("onBeforeGetAudioLink",window),t="undefined"!=typeof t?t:rspkr.HL,this.audioLink=null;var n={};for(var a in this.params)this.params.hasOwnProperty(a)&&(n[a]=this.params[a]);for(var a in e)e.hasOwnProperty(a)&&(n[a]=e[a]);n.speed=r.speed(rspkr.Common.Settings.get("hlspeed"),n.speed?n.speed:void 0);var i=rspkr.cfg.item("general.selectionEngine");if(i&&"newcontent"===i&&n.hasOwnProperty("readid")&&this.selectedText.length<1&&(!document.selection||document.selection&&rspkr.Common.data.browser.version>8&&document.documentMode>8)&&this.createReadRange(n.readid),n.readid&&/rslightbox_content/gi.test(n.readid)){0==rs.cfg.item("general.usePost")?(rs.cfg.item("general.usePost",!0),rspkr.c.addEvent("onSettingsClosed",function(){rs.cfg.item("general.usePost",!1),rs.PlayerAPI.stop()})):rspkr.c.addEvent("onSettingsClosed",function(){rs.PlayerAPI.stop()});var o=function(e){for(var t=function(e,t){var r;return r=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null)[t]:e.currentStyle?e.currentStyle[t]:e.style[t]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r],s=n.className&&-1!==n.className.indexOf("rs_skip_always");1!==n.nodeType||"none"!=t(n,"display")&&"hidden"!=t(n,"visibility")||s?n.title?$rs.addClass(n,"rs_skip_always"):1===n.nodeType&&o(n):$rs.addClass(n,"rs_skip_always")}};o($rs.get("rslightbox_content"))}return this.selectedText.length>0||this.selectedHTML.length>0?(this.selectedText.length>0&&t.clientMarkup.preProcess.init(),n.sync="user",n.syncalignuser=rspkr.st.get("hl"),this.setPostContent("textsel"),this.audioLink=c.issuePost(n)):rspkr.cfg.item("general.premarkup")===!0?(n.sync="user",this.setPostContent("nosel"),this.audioLink=rspkr.pub.Config.item("general.usePost")===!0?c.issuePost(n):s(n)):rspkr.pub.Config.item("general.usePost")===!0?(n.sync="wordsent",this.setPostContent("nosel"),this.audioLink=c.issuePost(n)):(n.sync="wordsent",this.audioLink=s(n)),rspkr.log("[rspkr.c.data.getAudioLink] Audio link: "+this.audioLink),this.audioLink},setSettingsChanged:function(e,t,r){"hlspeed"===e&&(rspkr.c.data.settingsChanged=!0)},settingsChanged:!1,getSaveData:function(e,t){rspkr.log("[rspkr.c.data.getSaveData]"),e=e||"link",t=t||!1;var n=this.saveLink;if(!this.saveLink||this.settingsChanged||t){if(t&&rspkr.c.data.setParams(t),!rspkr.c.data.params.customerid){var a=$rs.get("."+rspkr.cfg.item("ui.rsbtnClass"));a=$rs.isArray(a)&&a.length>0?a[0]:a,a&&rspkr.c.data.setParams($rs.getAttr($rs.findIn(a,".rsbtn_play"),"href"))}var i={},o={audioformat:"mp3"};this.settingsChanged=!1,"iOS"!==this.browser.OS&&"dialog"===e&&(o.save="1");for(var l in this.params)this.params.hasOwnProperty(l)&&(i[l]=this.params[l]);for(var l in o)o.hasOwnProperty(l)&&(i[l]=o[l]);i.speed=r.speed(rspkr.st.get("hlspeed"),i.speed),this.selectedHTML.length>0?(this.setPostContent("textsel"),n=c.issuePost(i)):rspkr.cfg.item("general.usePost")===!0?(this.setPostContent("nosel"),n=c.issuePost(i)):n=s(i),t||(this.saveLink=n)}return n}},s=function(e){var t="";if("undefined"!=typeof rspkr.cfg.item("general.servercall"))t=rspkr.cfg.item("general.servercall")+"?";else{var r=$rs.get("."+rspkr.cfg.item("ui.rsbtnClass"));r=$rs.isArray(r)?r[0]:r,t=$rs.getAttr($rs.findIn(r,".rsbtn_play"),"href").split("?")[0]+"?"}for(var n in e)e.hasOwnProperty(n)&&e[n]&&(t+=n+"="+e[n]+"&");t=t.substr(0,t.length-1);var s=rs.cfg.item("general.customProxy")?rs.cfg.item("general.customProxy")+encodeURIComponent(t):t;return s},a=function(){var t=rspkr.cfg.item("extraMods")||[],r=[e.major,e.minor,e.update,e.revision].join("."),n=0,s="Explorer"==rs.c.data.browser.name&&rs.c.data.browser.version<=8;rspkr.log("[rspkr.c.loadExtraMods] Number of mod files to load: "+t.length);for(var a=0;a<t.length;a++){var i=t[a][0],o=i.substring(i.lastIndexOf(".")),l=void 0;if(".js"===o)l=document.createElement("script"),l.type="text/javascript",l.src=rs.params.path+"mods/"+i+"?v="+r,l.async=!0;else if(".css"===o){var d=rs.params.path+"mods/"+i+"?v="+r;s?l=document.createStyleSheet(d):(l=document.createElement("link"),l.type="text/css",l.rel="stylesheet",l.href=d)}s||void 0===l.onreadystatechange?l.onload=function(e){e&&"function"==typeof e&&e.apply(window),n++,n==t.length&&rs.devt("onAfterExtraModsLoaded",window)}(t[a][1]):l.onreadystatechange=function(e){("complete"==l.readyState||"loaded"==l.readyState)&&(e&&"function"==typeof e&&e.apply(window),n++,n==t.length&&rs.devt("onAfterExtraModsLoaded",window))}(t[a][1]),s&&".css"===o||document.getElementsByTagName("head")[0].appendChild(l)}},i={init:function(){rspkr.log("[rspkr.c.Detect] Initialized!");var e=navigator.userAgent;n.browser.name=this.searchString(this.dataBrowser)||"Unknown",n.browser.version=this.searchVersion(e)||this.searchVersion(navigator.appVersion)||"Unknown",n.browser.OS=this.searchString(this.dataOS)||"Unknown",n.browser.flashVersion=this.getFlashVersion(),rspkr.log("[rspkr.c.Detect.init] Flash version: "+n.browser.flashVersion,1),n.browser.syncContainer="default"!==rspkr.pub.Config.item("general.syncContainer")?rspkr.pub.Config.item("general.syncContainer"):"rs:span";var t=n.browser.name;if(this.browserSettings.hasOwnProperty(n.browser.name)||(this.browserSettings[t]={}),"default"===rspkr.pub.Config.item("general.syncContainer")&&this.browserSettings[t].hasOwnProperty("syncContainer")&&(n.browser.syncContainer=this.browserSettings[t].syncContainer),this.browserSettings[t].hasOwnProperty("html5Support")?n.browser.html5Support=this.browserSettings[t].html5Support:document.createElement("audio").canPlayType&&(n.browser.html5Support=!0),n.browser.html5Support===!0){var r=document.createElement("audio"),s=!1,a=!1;r.canPlayType&&(s=!!r.canPlayType&&""!=r.canPlayType("audio/mpeg"),a=!!r.canPlayType&&""!=r.canPlayType('audio/ogg; codecs="vorbis"')),rspkr.log("Browser can play mp3? "+r.canPlayType("audio/mpeg"),1),rspkr.log("Browser can play ogg? "+r.canPlayType('audio/ogg; codecs="vorbis"'),1),/android/i.test(rspkr.Common.data.browser.OS)&&/chrome/i.test(rspkr.Common.data.browser.name)?n.browser.html5AudioFormat="ogg":s===!0?n.browser.html5AudioFormat="mp3":a===!0?n.browser.html5AudioFormat="ogg":n.browser.html5Support=!1,n.browser.html5Priority=this.browserSettings[t].hasOwnProperty("html5Priority")?this.browserSettings[t].priority:!0,this.browserSettings[t].hasOwnProperty("audioFormat")&&(n.browser.html5AudioFormat=this.browserSettings[t].audioFormat)}this.browserSettings[t].hasOwnProperty("minver")&&parseFloat(n.browser.version)<=parseFloat(this.browserSettings[t].minver)&&(n.browser.html5Priority=!1)},browserSettings:{Android:{minver:4},Explorer:{syncContainer:"font"},Firefox:{minver:6},Opera:{html5Support:!1,priority:!1}},getFlashVersion:function(){try{if(document.selection){try{var e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");try{e.AllowScriptAccess="always"}catch(t){return"6,0,0"}}catch(t){}return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}try{if(navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin)return(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(r){}}catch(t){try{if(navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin)return(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(r){}}return"0,0,0"},searchString:function(e){for(var t=0;t<e.length;t++){var r=e[t].string,n=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,r){if(-1!=r.indexOf(e[t].subString))return e[t].identity}else if(n)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chromium",identity:"Chromium"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iOS"},{string:navigator.userAgent,subString:"iPad",identity:"iOS"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]},o={create:function(e,t,r,n,s){r=r||rspkr.pub.Config.item("general.cookieLifetime"),n=n||rspkr.pub.Config.item("general.cookiePath"),s=s||rspkr.pub.Config.item("general.cookieDomain");var a;if(r){var i=new Date;i.setTime(i.getTime()+r),a="; expires="+i.toGMTString()}else a="";var o=n?"; path="+n:"",l=s?"; domain="+s:"",d=e+"="+t+a+o+l;return document.cookie=d},read:function(e){for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var s=r[n];" "==s.charAt(0);)s=s.substring(1,s.length);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return void 0},readKey:function(e,t){var r,n=this.read(e);if(n){n=n.split("&");for(var s=0,a=n.length;a>s;s++)if(r=n[s].split("="),r[0]==t)return r[1]}return void 0},readKeyAll:function(e){var t,r=this.read(e),n={};if(r){r=r.split("&");for(var s=0,a=r.length;a>s;s++)t=r[s].split("="),n[t[0]]=t[1];return n}return void 0},createSub:function(e,t,r,n,s){if("object"==typeof t){var a=[];for(var i in t)a.push(i+"="+t[i]);return this.create(e,a.join("&"),r,n,s)}this.create(e,t.toString(),r,n,s)},updateKey:function(e,t,r,n,s,a){r=r.toString();var i,o=decodeURIComponent(this.read(e)),l={},d=!1;o=o&&"null"!=o&&"undefined"!=o?o.indexOf("=")>-1&&-1==o.indexOf("&")?[o]:o.split("&"):[];for(var c=0,p=o.length;p>c;c++)i=o[c].split("="),i[0]==t&&(i[1]=r,d=!0),i.length&&i[1].length&&(l[i[0]]=i[1]);return!d&&r.length&&(l[t]=r),this.createSub(e,l,n,s,a)},erase:function(e,t,r){this.create(e,"",-1,t,r)}},l=function(e,r){t[e].push(r)},d=function(e,r,n){if(t[e]){n=n||[];if(rspkr.displog[e]=rspkr.displog[e]?++rspkr.displog[e]:1,!t[e].length)return rspkr.log("[rspkr.c] Dispatched event: "+e+" - no handlers to call.",2),!0;rspkr.log("[rspkr.c] Dispatching event: "+e,1);for(var s in t[e])if(t[e].hasOwnProperty(s)&&"function"==typeof t[e][s])try{"__self__"===r&&(r=t[e][s]),t[e][s].apply(r,n)}catch(a){rspkr.log("[rspkr.c._dispatchEvent] Error: "+a.message,3),this.isok=!1}else if("object"==typeof t[e][s])try{var i=t[e][s];i.func.apply(i.context||window,i.params||n)}catch(a){this.isok=!1}}else rspkr.log("[rspkr.c] Undefined event: "+e,3)},c={issuePost:function(e){rspkr.log("[rspkr.c] Using POST"),document.getElementById("ReadSpeakerPostIframe")||this.createIframe();var t,r,s,a=Math.random(),i=this.createForm(e);t="undefined"!=typeof rspkr.cfg.item("general.servercall")?rspkr.cfg.item("general.servercall")+"?":function(){var e=$rs.get("."+rspkr.cfg.item("ui.rsbtnClass"));return e=$rs.isArray(e)?e[0]:e,$rs.getAttr($rs.findIn(e,".rsbtn_play"),"href").split("?")[0]+"?"}(),r=function(e){var t="string"==typeof e&&e.length?e.split("/").pop():rspkr.pub.Config.item("general.rsent");return t.replace("?","")}(t),t=t&&t.match(/[^\/]*\/\/[^\/]*/),s=t?t.pop()+"/enterprise/iframeproxy.php?rsent="+r+"&version="+rspkr.pub.Config.item("general.proxyVersion"):rspkr.pub.Config.item("general.protocol")+"//"+rspkr.pub.Config.item("general.subdomain")+"."+rspkr.pub.Config.item("general.domain")+"/enterprise/iframeproxy.php?rsent="+rspkr.pub.Config.item("general.rsent")+"&version="+rspkr.pub.Config.item("general.proxyVersion"),s+="&randid="+a;var o=rs.cfg.item("general.customProxy")?rs.cfg.item("general.customProxy")+encodeURIComponent(s):s;i.action=o;var l=document.createElement("textarea");return n.getSelectedText().length>1?l.setAttribute("name","selectedhtml_base64"):l.setAttribute("name","html_base64"),l.innerHTML=n.getPostContent(),i.appendChild(l),setTimeout(function(){document.body.appendChild(i),i.submit(),document.body.removeChild(i)},0),o+"&listen=1&randid="+a},createForm:function(e){var t,r=document.createElement("form");r.target="ReadSpeakerPostIframe",r.method="post";for(var n in e)t=document.createElement("input"),t.setAttribute("name",n),"url"===n?t.setAttribute("value",decodeURIComponent(e[n])):t.setAttribute("value",e[n]),r.appendChild(t);return t=document.createElement("input"),t.setAttribute("name","output"),t.setAttribute("value","audiolink"),r.appendChild(t),r},createIframe:function(){var e=null;if(document.selection)try{e=document.createElement('<iframe name="ReadSpeakerPostIframe">')}catch(t){e=document.createElement("iframe")}else e=document.createElement("iframe");e.setAttribute("name","ReadSpeakerPostIframe"),e.setAttribute("id","ReadSpeakerPostIframe"),e.setAttribute("style","display: none; position: absolute;"),e.style.display="none";var r=document.getElementsByTagName("body"),n=null;r.length>0&&(n=r.item(0)),n&&n.appendChild(e)},removeIframe:function(){document.getElementById("ReadSpeakerPostIframe")&&document.body.removeChild(document.getElementById("ReadSpeakerPostIframe"))}},p={encode:function(e){newdata=encodeURIComponent(e);for(var t=0,r=0,n=[];t<newdata.length;t++)newdata.charCodeAt(t)!="%".charCodeAt(0)?n[r]=newdata.charCodeAt(t):(n[r]=parseInt("0x"+newdata.charAt(t+1)+newdata.charAt(t+2)),t+=2),r++;var s,a=n.length,i=(4*parseInt((a+2)/3),new String),o=parseInt(a/3),l=a-3*o;for(t=0;3*o>t;t+=3)s=this.chars(n[t]>>2),i+=s,s=this.chars((3&n[t])<<4|n[t+1]>>4),i+=s,s=this.chars((15&n[t+1])<<2|n[t+2]>>6),i+=s,s=this.chars(63&n[t+2]),i+=s;return 1==l&&(i+=this.chars(n[t]>>2),i+=this.chars((3&n[t])<<4),i+="=",i+="="),2==l&&(i+=this.chars(n[t]>>2),i+=this.chars((3&n[t])<<4|n[t+1]>>4),i+=this.chars((15&n[t+1])<<2),i+="="),i},decode:function(e){for(var t="",r="",n=0,s=0,a="",i=e.length;i>n;)if(-1!=this.value(e[n])){a=e.substring(n,n+4),s=0;for(var o=0;4>o;o++)"="==a[o]&&s++;for(o=0;3-s>o;o++){0==o?r=this.value(a[0])<<2|(48&this.value(a[1]))>>4:1==o?r=(15&this.value(a[1]))<<4|(60&this.value(a[2]))>>2:2==o&&(r=(3&this.value(a[2]))<<6|this.value(a[3]));var l=r.toString(16);1==l.length&&(l="0"+l),t+="%"+l}n+=4}else n++;return decodeURIComponent(t)},value:function(e){var t=e.charCodeAt(0);return t>="A".charCodeAt(0)&&t<="Z".charCodeAt(0)?t-"A".charCodeAt(0):t>="a".charCodeAt(0)&&t<="z".charCodeAt(0)?t-"a".charCodeAt(0)+26:t>="0".charCodeAt(0)&&t<="9".charCodeAt(0)?t-"0".charCodeAt(0)+52:t=="+".charCodeAt(0)?62:t=="/".charCodeAt(0)?63:-1},chars:function(e){return 26>e?String.fromCharCode(e+"A".charCodeAt(0)):52>e?String.fromCharCode(e+"a".charCodeAt(0)-26):62>e?String.fromCharCode(e+"0".charCodeAt(0)-52):62==e?"+":63==e?"/":String.fromCharCode(0)}},u={getStylesheet:function(e){var t;if(t=document.styleSheets[e]||document.getElementById(e))t=t;else{t=document.createElement("style"),t.type="text/css",t.id=t.name=e;var r=document.getElementsByTagName("head")[0]||document.body;r.appendChild(t),t=t.addRule||t.sheet?t:document.styleSheets[e]}return t.sheet||t},rsSheet:function(e){try{this.rules=e.rules||e.cssRules}catch(t){this.rules=e.cssRules}this.del=function(e,t){e.deleteRule?e.deleteRule(t):e.removeRule&&e.removeRule(t)},this.ins=function(e,t,r){if($rs.isArray(r)||(r=[r]),e.insertRule&&e.cssRules)e.insertRule(t+" {"+r.join(";")+";}",e.cssRules.length);else if(e.addRule)for(var n=0,s=r.length;s>n;n++)e.addRule(t,r[n])}},setRule:function(e,t,r){var n=this.getStylesheet(e),s=new this.rsSheet(n);return s.ins(n,t,"string"==typeof r?r.split(";"):r),s.length},removeRule:function(e,t){var r=this.getStylesheet(e),n=new this.rsSheet(r),s=[];if(n.rules){for(var a=0,i=n.rules.length;i>a;a++)n.rules[a].selectorText==t&&s.push(a);for(;s.length;)n.del(r,s.pop());return s}return n},replaceRule:function(e,t,r){this.removeRule(e,t),this.setRule(e,t,r)}},h={findFirstRSButton:function(e){e=e||document.body;for(var t=e.getElementsByTagName("a"),r=0,n=t.length;n>r;r++){if($rs.hasClass(t[r],"rsbtn_play"))return t[r];if(t[r].href&&-1!==t[r].href.indexOf(rspkr.pub.Config.item("general.domain")+"/cgi-bin/"+rspkr.pub.Config.item("general.rsent")))return t[r];if(t[r].href&&/customerid=/i.test(t[r].href)&&/lang=/i.test(t[r].href)&&/(readid|readclass)/i.test(t[r].href))return t[r]}return!1},createShortcuts:function(){var e=window.ReadSpeaker;e.Common&&(e.c=e.Common),e.c&&(e.evt=e.c.addEvent,e.devt=e.c.dispatchEvent),e.c&&e.c.Settings&&(e.c.s=e.c.Settings),e.c.s&&(e.st=e.c.s),e.lib&&(e.l=e.lib),e.l&&e.lib.Facade&&(e.l.f=e.lib.Facade),e.l&&e.l.f&&e.l.f.adapter&&(e.l.f.a=e.l.f.adapter),e.modmap&&(e.m=e.modmap),e.pub&&e.pub.Config&&(e.pub.c=e.pub.Config),e.pub.c&&(e.cfg=e.pub.c),e.PlayerAPI&&(e.pl=e.PlayerAPI),e.HL&&(e.hl=e.HL),e.ui&&(e.u=e.ui)}};return{meta:e,init:function(){d("onInit",window),t.onInit=[],l("onUIShowPlayer",rspkr.Common.data.setDefaultValues),l("onSettingsChanged",rspkr.Common.data.setSettingsChanged),l("onAfterModsLoaded",a)},addEvent:function(e,t){l(e,t)},base64:p,buildReadSpeakerCall:function(e){return s(e)},data:n,Detect:i,dispatchEvent:function(e,t,r){d(e,t,r)},post:c,cookie:o,css:u,converter:r,findFirstRSButton:h.findFirstRSButton,decodeEntities:function(e){var t,r=document.createElement("p");return r.innerHTML=e,t=r.textContent||r.innerText,r=null,t},e:t,createShortcuts:h.createShortcuts}}(),rspkr.lib||(rspkr.lib={}),rspkr.lib.Facade=function(window){var _versionCheck=function(v1,comparator,v2){v1=String(v1),v2=String(v2),comparator="="==comparator?"==":comparator;for(var v1parts=v1.split("."),v2parts=v2.split("."),maxLen=Math.max(v1parts.length,v2parts.length),part1,part2,cmp=0,i=0;maxLen>i&&!cmp;i++)part1=parseInt(v1parts[i],10)||0,part2=parseInt(v2parts[i],10)||0,part2>part1&&(cmp=1),part1>part2&&(cmp=-1);return eval("0"+comparator+cmp)},_libs=[{name:"jquery",minver:"1.4",check:function(){if("function"==typeof jQuery){if("explorer"===rspkr.Common.data.browser.name.toLowerCase()&&rspkr.Common.data.browser.version<9&&_versionCheck(jQuery.fn.jquery,"<",2))return!1;if(_versionCheck(jQuery.fn.jquery,">=",this.minver))return!0}return!1}}],_libfallback={name:"RSLib",minver:"1.0"},_uselib="",_setLib=function(){if(rspkr&&rspkr.params&&rspkr.params.forceRSLib&&"1"===rspkr.params.forceRSLib)_uselib=_libfallback.name;else{for(idx in _libs)if(_libs[idx]&&_libs[idx].check&&_libs[idx].check()){_uselib=_libs[idx].name;break}_uselib.length||(_uselib=_libfallback.name)}},_extendLib=function(){window.$rs.flatten=function(e,t){t=t||[];for(var r,n=0;r=e[n];n++)$rs.isArray(r)?$rs.flatten(r,t):t.push(r);return t}},_EventQueue={store:[],push:function(e,t,r){return this.store[e]||(this.store[e]=[]),this.store[e][t]||(this.store[e][t]=[]),this.store[e][t].push(r),this.store.length},pop:function(e,t,r){var n;if(this.store[e]&&this.store[e][t]){if(n=this.store[e][t],!r)return this.store[e][t].splice(0,this.store[e][t].length),0;for(var s=n.length-1;s>-1;s--)n[s].toString()==r.toString()&&this.store[e][t].splice(s,1);return this.store[e][t].length}return 0},dispatch:function(e,t){var r=$rs.convertEvent(e,t);if(rsid=$rs.getAttr(r.target,"data-rsevent-id"),rsid){for(var n=!0,s=_EventQueue.store[rsid][r.type],a=0,i=s.length;i>a;a++)"function"==typeof s[a]&&(s[a].apply(r.target,[r])||(n=!1));return n}}};return{init:function(){_setLib()},currentLib:function(){return _uselib},setLib:function(e){_uselib=e},eq:_EventQueue,adapterInit:function(e){window.$rs=e,_extendLib()}}}(window),ReadSpeaker.lib.Facade.RSEvent=function(){},ReadSpeaker.modmap={products:{all:[["Common.Settings","text/javascript",["Common.Settings"]]],custom:function(){var e=[];return e.push(["Custom","text/javascript"]),e},dr:function(){var e=[];return e.push(["DocReader.AutoAdd","text/javascript"]),e},expl:function(){var e=this.all;return e.push(["PlayerAPI","text/javascript"],["XP","text/javascript"],["ui","text/javascript",["ui","ui.Lightbox","ui.Slider"]]),e},embhl:function(){var e=this.all;return e.push(["PlayerAPI","text/javascript"],["HL","text/javascript"],["ui","text/javascript",["ui","ui.Lightbox","ui.Slider"]]),e}}};